:PROPERTIES:
:ID:       b8f52fdd-93b8-49f1-88ca-0a7c065e30bb
:END:
#+title: export org-roam to org-git, how to
# tag export publish

# PITFALL: Do this before defining variables,
# or they will silently become the empty string.
ssh-agent bash
ssh-add

# The only text files used in this script.
THESE_FOLDER_NAMES=these-folder-names.txt
THESE_FOLDER_NAMES_AND_URLS=these-folder-names-and-urls.txt

# CAREFUL: Run this separately and verify,
# to be sure I don't delete the original data:
# This should be "github-exported" (better to say "published") data.
cd /home/jeff/ugh/une/github-exported-org-roam

# Verify what THESE_FOLDER_NAMES is:
# local repos with little history,
# maybe not even associated with Github repos.
for f in $(cat $THESE_FOLDER_NAMES); do
  echo ""
  echo $f
  cd $f
  git log | wc
  cd ..
done

# OBLITERATE those local repos.
for f in $(cat $THESE_FOLDER_NAMES); do
  rm $f -rf
done

# Rebuild them.
cd /home/jeff/code/org-roam-to-org-git
cabal run

# wart
cd /home/jeff/ugh/une/github-exported-org-roam
cp ~/org-roam/public/README.md ./public/

# Verify the repos in THESE_FOLDER_NAMES_AND_URLS are safe to wipe:
# The URLs are all remotes that match 'github.navigable'.
rg -e 'github.navigable' $THESE_FOLDER_NAMES_AND_URLS -C 1000
  # -C 1000 is a hacky way to guarantee the whole file is visible.

# OBLITERATE prior data on remote repos.
while read -r folder remote; do
  cd $folder
  git init
  git add '*.org' # This recurses into subfolders.
  git add '*.md'  # This recurses into subfolders.
  git commit -m "everything"
  git remote add origin $remote
  git push -f --set-upstream origin main
  git branch -M main
  cd ..
done < $THESE_FOLDER_NAMES_AND_URLS

# Verify that none of my .org-formatted data was affected.
# (If pushing fails something is wrong.)
cd ~/org-roam
./bash/push-all.sh

# PITFALL: I had a problem with a filename that had a tilde
# in the original repo. In the github-formatted repo,
# it became wise-hallucinated...-autom\303\241tico...org,
# and then git was unable to find the path.

# try visiting a new or modified file online
https://github.com/JeffreyBenjaminBrown/public_notes_with_github-navigable_links/blob/main/artificial_intelligence.org

# fix a few broken links
find . -name "*.org" -print0 | xargs -0 grep -i "broken link?]]" --color
